<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reportes</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/reportes.css') }}">

</head>

<body>

<div class="container">

<!-- ================= FORMULARIO ================= -->
<div class="card">
<h2>ðŸ“‹ Registrar Reporte</h2>

<form method="POST" action="/reportes">

    <label>Tipo de reporte</label>
    <select id="tipo" name="tipo" onchange="cargarPersonas()" required>
        <option value="">Seleccione</option>
        <option value="alumno">Alumno</option>
        <option value="profesor">Profesor</option>
    </select>

    <label>Persona</label>
    <select id="persona" onchange="asignarID()" required>
        <option value="">Seleccione</option>
    </select>

    <input type="hidden" name="persona_id" id="persona_id">

    <label>Motivo</label>
    <textarea name="motivo" required></textarea>

    <label>Hora</label>
    <input type="time" name="hora" required>

    <label>Fecha</label>
    <input type="date" name="fecha" required>

    <button type="submit">Guardar Reporte</button>
</form>
</div>
<a href="{{ url_for('menu') }}">
            ðŸ“‹ Ir al MenÃº
<a href="{{ url_for('dashboard') }}" class="btn-volver">
    â¬… Volver al Dashboard
</a>

<!-- ================= TABLA ================= -->
<div class="card">
<h2>ðŸ“„ Reportes Registrados</h2>

<table>
<tr>
    <th>ID</th>
    <th>Tipo</th>
    <th>Nombre</th>
    <th>Persona ID</th>
    <th>Motivo</th>
    <th>Hora</th>
    <th>Fecha</th>
    <th>Acciones</th>
</tr>

{% for r in reportes %}
<tr>
    <td>{{ r.id }}</td>
    <td>{{ r.tipo }}</td>
    <td>{{ r.nombre_persona }}</td>
    <td>{{ r.persona_id }}</td>
    <td>{{ r.motivo }}</td>
    <td>{{ r.hora }}</td>
    <td>{{ r.fecha }}</td>
    <td class="actions">

        <form method="GET" action="/imprimir_reporte/{{ r.id }}" target="_blank">
            <button type="submit">Imprimir</button>
        </form>

        <form method="GET" action="/reportes/eliminar/{{ r.id }}">
            <button type="submit">Eliminar</button>
        </form>

    </td>
</tr>
{% endfor %}
</table>

<!-- ================= FIRMAS ================= -->
<div class="firmas">
    <div class="firma">
        <div class="linea"></div>
        <p>Director(a)</p>
    </div>
    <div class="firma">
        <div class="linea"></div>
        <p>Orientador(a)</p>
    </div>
    <div class="firma">
        <div class="linea"></div>
        <p>Quien reporta</p>
    </div>
</div>

</div>
</div>

<!-- ================= DATOS JSON ================= -->
<script id="data-alumnos" type="application/json">
    {{ alumnos | tojson }}
</script>

<script id="data-profesores" type="application/json">
    {{ profesores | tojson }}
</script>

<!-- ================= SCRIPT ================= -->
<script>
const alumnos = JSON.parse(
    document.getElementById("data-alumnos").textContent
);

const profesores = JSON.parse(
    document.getElementById("data-profesores").textContent
);

function cargarPersonas() {
    const tipo = document.getElementById("tipo").value;
    const persona = document.getElementById("persona");

    persona.innerHTML = '<option value="">Seleccione</option>';

    if (!tipo) return;

    if (tipo === "alumno") {
        alumnos.forEach(a => {
            const option = document.createElement("option");
            option.value = a.id;
            option.textContent = a.nombre;
            persona.appendChild(option);
        });
    }

    if (tipo === "profesor") {
        profesores.forEach(p => {
            const option = document.createElement("option");
            option.value = p.numero_empleado;
            option.textContent = p.nombre_docente;
            persona.appendChild(option);
        });
    }
}

function asignarID() {
    document.getElementById("persona_id").value =
        document.getElementById("persona").value;
}
</script>


</body>
</html>

<!-- Reportes.html -->
