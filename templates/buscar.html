<!DOCTYPE html>
<html>
<head>
    <title>Buscador general</title>
</head>
<body>

<!-- BUSCADOR DE RECURSOS -->
<div class="search-box">
    <h2>BÃºsqueda de recursos</h2>
    <form action="/buscar" method="GET">
        <input type="text" name="q" placeholder="Buscar recurso..." value="{{ termino }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozRecursos" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if resultados %}
        <h3 style="text-align:center;">Resultados:</h3>
        <ul>
            {% for item in resultados %}
                <li>
                    <b>{{ item.nombre }}</b><br>
                    {{ item.docente }} â€” {{ item.materia }}<br>
                    <a href="/uploads/{{ item.archivo }}">ðŸ“„ Ver archivo</a>
                    <a href="/uploads/{{ item.archivo }}" download class="btn-descargar">â¬‡ Descargar</a>
                    <a href="javascript:void(0)" onclick="imprimirDocumento('/uploads/{{ item.archivo }}')" class="btn-descargar">ðŸ–¨ Imprimir</a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron resultados.</p>
    {% endif %}
</div>

<!-- BUSCADOR DE ALUMNOS -->
<div class="search-box">
    <h2>BÃºsqueda de alumnos</h2>
    <form action="/buscar_alumno" method="GET">
        <input type="text" name="q" placeholder="Buscar por CURP, nombre, grupo..." value="{{ termino_alumno }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozAlumnos" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if alumnos %}
        <h3 style="text-align:center;">Resultados de alumnos:</h3>
        <ul>
            {% for a in alumnos %}
                <li>
                    <b>{{ a.nombre }} {{ a.apellido_paterno }} {{ a.apellido_materno }}</b><br>
                    CURP: {{ a.curp }}<br>
                    Turno: {{ a.turno }} â€” Grupo: {{ a.grupo }} â€” Semestre: {{ a.semestre }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron alumnos.</p>
    {% endif %}
</div>

<!-- BUSCADOR DE PROFESORES -->
<div class="search-box">
    <h2>BÃºsqueda de profesores</h2>
    <form action="/buscar_profesor" method="GET">
        <input type="text" name="q" placeholder="Buscar por nombre, nÃºmero de empleado, asignatura..." value="{{ termino_profesor }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozProfesores" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if profesores %}
        <h3 style="text-align:center;">Resultados de profesores:</h3>
        <ul>
            {% for p in profesores %}
                <li>
                    <b>{{ p.nombre_docente }}</b><br>
                    NÃºmero de empleado: {{ p.numero_empleado }}<br>
                    Fecha de ingreso: {{ p.fecha_ingreso }}<br>
                    Perfil: {{ p.perfil_profesional }}<br>
                    Asignatura: {{ p.asignatura }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron profesores.</p>
    {% endif %}
</div>

<!-- BUSCADOR DE ORIENTADORES -->
<div class="search-box">
    <h2>BÃºsqueda de orientadores</h2>
    <form action="/buscar_orientador" method="GET">
        <input type="text" name="q" placeholder="Buscar por nÃºmero de empleado, nombre o grupo..." value="{{ termino_orientador }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozOrientadores" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if orientadores %}
        <h3 style="text-align:center;">Resultados de orientadores:</h3>
        <ul>
            {% for o in orientadores %}
                <li>
                    <b>{{ o.nombre }}</b><br>
                    NÃºmero de empleado: {{ o.numero_empleado }}<br>
                    Grupos que atiende: {{ o.grupos_atendidos }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron orientadores.</p>
    {% endif %}
</div>

<!-- BUSCADOR DE DIRECTIVOS -->
<div class="search-box">
    <h2>BÃºsqueda de directivos</h2>
    <form action="/buscar_directivo" method="GET">
        <input type="text" name="q" placeholder="Buscar por nÃºmero de empleado, nombre o puesto..." value="{{ termino_directivo }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozDirectivos" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if directivos %}
        <h3 style="text-align:center;">Resultados de directivos:</h3>
        <ul>
            {% for d in directivos %}
                <li>
                    <b>{{ d.nombre }}</b><br>
                    NÃºmero de empleado: {{ d.numero_empleado }}<br>
                    Puesto: {{ d.puesto }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron directivos.</p>
    {% endif %}
</div>

<!-- BUSCADOR DE MATERIAS -->
<div class="search-box">
    <h2>BÃºsqueda de materias</h2>
    <form action="/buscar_materia" method="GET">
        <input type="text" name="q" placeholder="Buscar por estructura curricular, nombre, horas o crÃ©ditos..." value="{{ termino_materia }}">
        <button type="submit">Buscar</button>
        <button type="button" id="btnVozMaterias" style="margin-left:8px;">ðŸŽ¤ Voz</button>
    </form>

    <hr>

    {% if materias %}
        <h3 style="text-align:center;">Resultados de materias:</h3>
        <ul>
            {% for m in materias %}
                <li>
                    <b>{{ m.nombre_materia }}</b><br>
                    Estructura curricular: {{ m.estructura_curricular }} <br>
                    Horas por semana: {{ m.horas_semana }} <br>
                    Horas totales: {{ m.horas_totales }} <br>
                    CrÃ©ditos: {{ m.creditos }} <br>

                    {% if m.archivo %}
                        <a href="/uploads/{{ m.archivo }}" target="_blank">ðŸ“„ Ver archivo</a>
                        <a href="/uploads/{{ m.archivo }}" download class="btn-descargar">â¬‡ Descargar</a>
                        <a href="javascript:void(0)" onclick="imprimirDocumento('/uploads/{{ m.archivo }}')" class="btn-descargar">ðŸ–¨ Imprimir</a>
                    {% else %}
                        Sin archivo
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="no-result">No se encontraron materias.</p>
    {% endif %}
</div>

<a href="{{ url_for('menu') }}" class="btn-regresar">â¬… Volver al MenÃº</a>

<!-- SCRIPT DE VOZ PARA TODAS LAS SECCIONES -->
<script>
function habilitarVoz(btnId, urlDestino) {
    const boton = document.getElementById(btnId);

    boton.addEventListener("click", () => {
        if (!("webkitSpeechRecognition" in window)) {
            alert("Tu navegador no soporta reconocimiento de voz.");
            return;
        }

        const rec = new webkitSpeechRecognition();
        rec.lang = "es-MX";
        rec.continuous = false;
        rec.interimResults = false;

        boton.innerText = "ðŸŽ™ Escuchando...";
        rec.onstart = () => console.log("âœ… MicrÃ³fono ACTIVADO");
        rec.start();

        rec.onresult = (event) => {
            const texto = event.results[0][0].transcript;
            boton.innerText = "ðŸŽ¤ Voz";

            fetch(urlDestino, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({texto})
            })
            .then(r => r.json())
            .then(data => {
                window.location.href = data.redirect;
            });
        };

        rec.onerror = (err) => {
            boton.innerText = "ðŸŽ¤ Voz";
            alert("Error al reconocer la voz: " + err.error);
        };

        rec.onend = () => boton.innerText = "ðŸŽ¤ Voz";
    });
}

// Activar voz para cada secciÃ³n
habilitarVoz("btnVozRecursos", "/voz_busqueda");
habilitarVoz("btnVozAlumnos", "/voz_busqueda_alumno");
habilitarVoz("btnVozProfesores", "/voz_busqueda_profesor");
habilitarVoz("btnVozOrientadores", "/voz_busqueda_orientador");
habilitarVoz("btnVozDirectivos", "/voz_busqueda_directivo");
habilitarVoz("btnVozMaterias", "/voz_busqueda_materia");
</script>

<!-- FUNCIÃ“N PARA IMPRIMIR -->
<script>
function imprimirDocumento(url) {
    const iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.src = url;
    document.body.appendChild(iframe);

    iframe.onload = function () {
        iframe.contentWindow.focus();
        iframe.contentWindow.print();
    };
}
</script>

</body>
</html>